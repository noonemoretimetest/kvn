<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cài addon Stremio — MonPlay</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 32px; background:#f7fafc; color:#0f172a; }
    .card{ max-width:680px; margin:32px auto; background:white; border-radius:12px; box-shadow:0 6px 18px rgba(2,6,23,.08); padding:28px; text-align:center;}
    h1 { margin:0 0 8px; font-size:20px; }
    p { margin:0 0 18px; color:#475569; }
    .btn { display:inline-block; padding:12px 18px; border-radius:10px; text-decoration:none; font-weight:600; cursor:pointer; border: none; background:#0ea5a4; color:white; margin:4px; }
    .fallback { margin-top:18px; color:#334155; font-size:14px; }
    .link { word-break:break-all; color:#0369a1; text-decoration:underline; cursor:text;}
    .note { margin-top:12px; font-size:13px; color:#64748b; }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Cài addon MonPlay cho Stremio</h1>
    <p>Nhấn nút bên dưới để mở Stremio và cài addon MonPlay.</p>

    <!-- Nút chính: cố mở custom protocol -->
    <button id="openBtn" class="btn">Mở và cài addon trong Stremio</button>

    <!-- Nút web fallback -->
    <a id="webBtn" href="https://web.stremio.com/#/addons?addon=https://sm.manucn.dpdns.org/manifest.json" target="_blank" class="btn">Cài addon qua Web Stremio</a>

    <div id="result" class="fallback" aria-live="polite" style="display:none;"></div>
  </div>

  <script>
    (function(){
      const openBtn = document.getElementById('openBtn');
      const result = document.getElementById('result');
      const manifestProtocol = 'stremio://sm.manucn.dpdns.org/manifest.json';

      function showMessage(html, isError){
        result.style.display = 'block';
        result.innerHTML = html;
        result.style.color = isError ? '#b91c1c' : '#166534';
      }

      function openStremio() {
        result.style.display = 'none';
        try {
          window.location = manifestProtocol;
          showMessage('Đã gửi yêu cầu mở Stremio. Nếu Stremio được cài, nó sẽ hỏi bạn xác nhận cài addon.', false);
        } catch (e) {
          try {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = manifestProtocol;
            document.body.appendChild(iframe);
            showMessage('Đã gửi yêu cầu mở Stremio (iframe). Nếu không có phản hồi, hãy thử nút Web bên dưới.', false);
            setTimeout(()=>iframe.remove(), 1000);
          } catch (er){
            showMessage('Không thể mở trực tiếp. Vui lòng dùng liên kết HTTPS hoặc copy liên kết stremio:// vào Stremio.', true);
          }
        }
      }

      openBtn.addEventListener('click', openStremio);
      openBtn.addEventListener('keyup', function(e){
        if(e.key === 'Enter' || e.key === ' ') openStremio();
      });
    })();
  </script>
</body>
</html>
